<!DOCTYPE html>
<html>
<head>
    <title>Debug AI Functions - Production Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a1a; color: white; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #333; border-radius: 5px; }
        .button { padding: 10px 20px; margin: 10px; background: #007acc; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .button:hover { background: #005999; }
        .result { margin: 10px 0; padding: 10px; background: #2a2a2a; border-radius: 3px; }
        .error { background: #ff4444; }
        .success { background: #44ff44; color: black; }
        .info { background: #4444ff; }
    </style>
</head>
<body>
    <h1>üö® Diagn√≥stico de Bugs - Sistema IA Produ√ß√£o</h1>
    <p>Esta p√°gina testa as funcionalidades de IA diretamente do sistema em produ√ß√£o</p>
    
    <div class="test-section">
        <h3>üéØ Teste 1: Tarefas IA - Respostas Incorretas</h3>
        <button class="button" onclick="testTarefasIA()">Testar Tarefas IA</button>
        <div id="tarefas-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>üß† Teste 2: Mentor IA - Prompt que n√£o fecha</h3>
        <button class="button" onclick="testMentorIA()">Testar Mentor IA</button>
        <div id="mentor-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>üß† Teste 3: Quiz IA - Erro de conex√£o</h3>
        <button class="button" onclick="testQuizIA()">Testar Quiz IA</button>
        <div id="quiz-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>üîç Teste 4: Analisar Recursos - Erro de conex√£o</h3>
        <button class="button" onclick="testAnalisarRecursos()">Testar Analisar</button>
        <div id="analisar-result" class="result"></div>
    </div>

    <script>
        // Importar sistema IA da produ√ß√£o
        const PRODUCTION_URL = 'https://roadmap-tech-ai.vercel.app';
        
        // Fun√ß√£o para abrir janela de produ√ß√£o e testar
        function openProductionWindow() {
            return window.open(`${PRODUCTION_URL}/pages/roadmap.html?id=data-scientist`, 'production', 'width=1200,height=800');
        }
        
        // Teste 1: Tarefas IA
        async function testTarefasIA() {
            const result = document.getElementById('tarefas-result');
            result.innerHTML = 'üîÑ Testando Tarefas IA...';
            
            try {
                const prodWindow = openProductionWindow();
                
                // Aguardar p√°gina carregar
                await new Promise(resolve => setTimeout(resolve, 5000));
                
                // Procurar card de Tarefas IA
                const tarefasCard = prodWindow.document.querySelector('[data-card="ai-task"]');
                
                if (!tarefasCard) {
                    result.innerHTML = '‚ùå Card Tarefas IA n√£o encontrado';
                    result.className = 'result error';
                    prodWindow.close();
                    return;
                }
                
                result.innerHTML = '‚úÖ Card encontrado. Clicando...';
                tarefasCard.click();
                
                // Aguardar modal
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                const modal = prodWindow.document.querySelector('.modal, #questionModal');
                if (modal) {
                    const question = modal.querySelector('.question-text, h3')?.textContent || 'N/A';
                    const alternatives = modal.querySelectorAll('.option, input[type="radio"]');
                    
                    result.innerHTML = `
                        ‚úÖ Modal aberto<br>
                        üìã Pergunta: ${question.substring(0, 50)}...<br>
                        üìã Alternativas: ${alternatives.length}<br>
                        üîÑ Testando sele√ß√£o...
                    `;
                    
                    // Testar sele√ß√£o de alternativa
                    if (alternatives.length > 0) {
                        alternatives[0].click();
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        
                        const isSelected = alternatives[0].checked || alternatives[0].classList.contains('selected');
                        
                        result.innerHTML += `<br>üìã Sele√ß√£o visual: ${isSelected ? '‚úÖ FUNCIONANDO' : '‚ùå BUG CONFIRMADO'}`;
                        result.className = isSelected ? 'result success' : 'result error';
                    }
                    
                    // Fechar modal
                    const closeBtn = modal.querySelector('.close, .modal-close');
                    if (closeBtn) closeBtn.click();
                } else {
                    result.innerHTML = '‚ùå Modal n√£o abriu - BUG CONFIRMADO';
                    result.className = 'result error';
                }
                
                prodWindow.close();
                
            } catch (error) {
                result.innerHTML = `‚ùå Erro: ${error.message}`;
                result.className = 'result error';
            }
        }
        
        // Teste 2: Mentor IA
        async function testMentorIA() {
            const result = document.getElementById('mentor-result');
            result.innerHTML = 'üîÑ Testando Mentor IA...';
            
            try {
                const prodWindow = openProductionWindow();
                await new Promise(resolve => setTimeout(resolve, 5000));
                
                const mentorCard = prodWindow.document.querySelector('[data-card="ai-mentor"]');
                
                if (!mentorCard) {
                    result.innerHTML = '‚ùå Card Mentor IA n√£o encontrado';
                    result.className = 'result error';
                    prodWindow.close();
                    return;
                }
                
                result.innerHTML = '‚úÖ Card encontrado. Clicando...';
                mentorCard.click();
                
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Verificar se modal customizado apareceu
                const inputModal = prodWindow.document.querySelector('.input-modal, #inputModal');
                
                if (inputModal) {
                    result.innerHTML = '‚úÖ Modal customizado encontrado<br>üîÑ Testando fechamento...';
                    
                    const closeBtn = inputModal.querySelector('.close, .modal-close');
                    if (closeBtn) {
                        closeBtn.click();
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        
                        const stillOpen = prodWindow.document.querySelector('.input-modal, #inputModal');
                        if (stillOpen && stillOpen.style.display !== 'none') {
                            result.innerHTML += '<br>‚ùå BUG CONFIRMADO: Modal n√£o fecha';
                            result.className = 'result error';
                        } else {
                            result.innerHTML += '<br>‚úÖ Modal fecha corretamente';
                            result.className = 'result success';
                        }
                    } else {
                        result.innerHTML += '<br>‚ùå BUG CONFIRMADO: Modal sem bot√£o fechar';
                        result.className = 'result error';
                    }
                } else {
                    result.innerHTML = '‚ö†Ô∏è Modal customizado n√£o encontrado - usando prompt() nativo';
                    result.className = 'result info';
                }
                
                prodWindow.close();
                
            } catch (error) {
                result.innerHTML = `‚ùå Erro: ${error.message}`;
                result.className = 'result error';
            }
        }
        
        // Teste 3: Quiz IA
        async function testQuizIA() {
            const result = document.getElementById('quiz-result');
            result.innerHTML = 'üîÑ Testando Quiz IA...';
            
            try {
                const prodWindow = openProductionWindow();
                await new Promise(resolve => setTimeout(resolve, 5000));
                
                const quizCard = prodWindow.document.querySelector('[data-card="ai-quiz"]');
                
                if (!quizCard) {
                    result.innerHTML = '‚ùå Card Quiz IA n√£o encontrado';
                    result.className = 'result error';
                    prodWindow.close();
                    return;
                }
                
                result.innerHTML = '‚úÖ Card encontrado. Clicando...';
                quizCard.click();
                
                // Aguardar resposta
                await new Promise(resolve => setTimeout(resolve, 8000));
                
                // Verificar se apareceu erro
                const errorText = 'N√£o foi poss√≠vel gerar o quiz';
                const bodyText = prodWindow.document.body.textContent;
                const hasError = bodyText.includes(errorText);
                
                if (hasError) {
                    result.innerHTML = '‚ùå BUG CONFIRMADO: Quiz IA retorna erro de conex√£o';
                    result.className = 'result error';
                } else {
                    // Verificar se apareceu modal de quiz
                    const quizModal = prodWindow.document.querySelector('.modal, #quizModal');
                    if (quizModal) {
                        result.innerHTML = '‚úÖ Quiz IA funcionando - Modal de quiz aberto';
                        result.className = 'result success';
                    } else {
                        result.innerHTML = '‚ö†Ô∏è Sem erro, mas modal de quiz n√£o encontrado';
                        result.className = 'result info';
                    }
                }
                
                prodWindow.close();
                
            } catch (error) {
                result.innerHTML = `‚ùå Erro: ${error.message}`;
                result.className = 'result error';
            }
        }
        
        // Teste 4: Analisar Recursos
        async function testAnalisarRecursos() {
            const result = document.getElementById('analisar-result');
            result.innerHTML = 'üîÑ Testando Analisar Recursos...';
            
            try {
                const prodWindow = openProductionWindow();
                await new Promise(resolve => setTimeout(resolve, 5000));
                
                const analisarCard = prodWindow.document.querySelector('[data-card="ai-analyze"]');
                
                if (!analisarCard) {
                    result.innerHTML = '‚ùå Card Analisar n√£o encontrado';
                    result.className = 'result error';
                    prodWindow.close();
                    return;
                }
                
                result.innerHTML = '‚úÖ Card encontrado. Clicando...';
                analisarCard.click();
                
                // Aguardar resposta
                await new Promise(resolve => setTimeout(resolve, 8000));
                
                // Verificar se apareceu erro
                const errorText = 'N√£o foi poss√≠vel analisar o recurso';
                const bodyText = prodWindow.document.body.textContent;
                const hasError = bodyText.includes(errorText);
                
                if (hasError) {
                    result.innerHTML = '‚ùå BUG CONFIRMADO: Analisar Recursos retorna erro de conex√£o';
                    result.className = 'result error';
                } else {
                    result.innerHTML = '‚úÖ Analisar Recursos funcionando corretamente';
                    result.className = 'result success';
                }
                
                prodWindow.close();
                
            } catch (error) {
                result.innerHTML = `‚ùå Erro: ${error.message}`;
                result.className = 'result error';
            }
        }
        
        // Auto-executar todos os testes
        window.onload = function() {
            console.log('üö® P√°gina de debug carregada - Execute os testes manualmente ou aguarde...');
        };
    </script>
</body>
</html>
